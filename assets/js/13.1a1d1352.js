(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{359:function(a,s,e){"use strict";e.r(s);var t=e(15),n=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),s("p",[a._v("本方案采用docker + typecho 进行快速搭建"),s("br"),a._v("\n演示环境： centos7")])]),a._v(" "),s("h2",{attrs:{id:"镜像构建与运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#镜像构建与运行"}},[a._v("#")]),a._v(" 镜像构建与运行")]),a._v(" "),s("p",[a._v("创建或进入一个目录，下载源文件")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" build\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://github.com/typecho/typecho.git typecho`\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" ./typecho/tools\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" typecho:0.1 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看是否成功构建，若因网络等原因构建失败可重试几次。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" images \n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("创建运行容器，并且映射端口9900")]),a._v(" "),s("p",[a._v("宿主机挂在目录："),s("code",[a._v("/server/docker-apps/typecho")]),a._v(" (当然你可以选择其他目录，前提自行解决目录访问权限问题)")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9900")]),a._v(":80 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" typecho  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /server/docker-apps/typecho:/www  typecho:0.1\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("strong",[a._v("无法访问？")])]),a._v(" "),s("ol",[s("li",[s("p",[a._v("安全组开放端口")])]),a._v(" "),s("li",[s("p",[a._v("防火墙开放端口")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("firewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("public --query-port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9900")]),a._v("/tcp\nfirewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("public --add-port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9900")]),a._v("/tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v("\nfirewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--reload")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])])])]),a._v(" "),s("p",[s("strong",[a._v("无法创建config.inc.php?")])]),a._v(" "),s("p",[a._v("容器内部"),s("code",[a._v("/www")]),a._v(" 目录所属（www-data）和权限(读写)。")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" www-data:www-data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" /www "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#容器内执行")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"容器修改"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器修改"}},[a._v("#")]),a._v(" 容器修改")]),a._v(" "),s("p",[a._v("容器运行成功后进行调试")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入容器内部")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" typecho "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 连接内置mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 默认密码123456， 可在构建前修改Dockerfile，更换指定mysql密码")]),a._v("\nmysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建数据库")]),a._v("\ncreate database "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v("  not exists typecho default charset utf8 collate utf8_general_ci"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h2",{attrs:{id:"宿主机调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#宿主机调试"}},[a._v("#")]),a._v(" 宿主机调试")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入挂载目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /server/docker-apps/typecho/\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 下载typecho代码")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" http://typecho.org/downloads/1.1-17.10.30-release.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxf")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.1")]),a._v("-17.10.30-release.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" build/* "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.1")]),a._v("-17.10.30-release.tar.g\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" build/\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h1",{attrs:{id:"typecho"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#typecho"}},[a._v("#")]),a._v(" Typecho")]),a._v(" "),s("p",[a._v("主站："),s("a",{attrs:{href:"http://typecho.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://typecho.org/"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("Typecho基于PHP5开发，支持多种"),s("a",{attrs:{href:"https://cloud.tencent.com/solution/database?from=10680",target:"_blank",rel:"noopener noreferrer"}},[a._v("数据库"),s("OutboundLink")],1),a._v("，是一款内核强健﹑扩展方便﹑体验友好﹑运行流畅的轻量级开源博客程序。")]),a._v(" "),s("p",[a._v("特点：")]),a._v(" "),s("ul",[s("li",[a._v("极简")]),a._v(" "),s("li",[a._v("轻量")]),a._v(" "),s("li",[a._v("内置数据库")])]),a._v(" "),s("h2",{attrs:{id:"更换主题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更换主题"}},[a._v("#")]),a._v(" 更换主题")]),a._v(" "),s("ol",[s("li",[a._v("首先下载Typecho主题文件。网上可以搜索到很多主题模板，选择一款喜欢的主题下载即可，然后将下载的主题文件解压到电脑上。")]),a._v(" "),s("li",[a._v("解压成功后将保存了主题的文件夹直接上传到Typecho网站，放到容器内"),s("code",[a._v("/www/usr/themes")]),a._v("目录下（自带一个default主题）。")]),a._v(" "),s("li",[a._v("主题文件上传成功后，我们进入到Typecho网站后台，点击控制台中的“外观”，激活启用该主题，然后刷新下网站，就可以看到新的主题了。")])]),a._v(" "),s("p",[a._v("自用主题："),s("code",[a._v("Typecho AL_lolimeow")])]),a._v(" "),s("h2",{attrs:{id:"更换插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更换插件"}},[a._v("#")]),a._v(" 更换插件")]),a._v(" "),s("ul",[s("li",[s("ul",[s("li",[a._v("操作同上，下载插件后放到容器内"),s("code",[a._v("/www/usr/plugins")]),a._v("目录下（自带一个HelloWorld插件），然后启用即可。")])])]),a._v(" "),s("li",[s("p",[a._v("typecho容器内"),s("code",[a._v("/www/usr/uploads")]),a._v("目录存放上传的文件，若上传文件失败，请检查容器内部该目录所属（www-data）和权限(读写)。如果想将typecho文件上传到其他文件存储服务，以便节省服务器磁盘空间，加快博客访问速度，可安装对应插件。可以参考另一篇文章")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("上传失败还有一种情况，nginx日志报错 "),s("code",[a._v("client intended to send too large body")]),a._v(",是因为nginx限制了客户端请求的大小，将限制放宽即可")])]),a._v(" "),s("li",[s("p",[a._v("在nginx配置的http下添加或修改以下配置")]),a._v(" "),s("p",[s("code",[a._v("client_max_body_size 50m;")])])])])])]),a._v(" "),s("p",[a._v("自用插件：")]),a._v(" "),s("ul",[s("li",[a._v("Links")]),a._v(" "),s("li",[a._v("APlayer for Typecho | Meting 修复版")]),a._v(" "),s("li",[a._v("jkSiteHelper")]),a._v(" "),s("li",[a._v("jkOptionsFramework")])]),a._v(" "),s("h2",{attrs:{id:"修改后台登陆地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改后台登陆地址"}},[a._v("#")]),a._v(" 修改后台登陆地址")]),a._v(" "),s("ul",[s("li",[a._v("修改typecho管理后台登陆地址")])]),a._v(" "),s("ol",[s("li",[s("p",[a._v("先将admin目录修改成自己知道名称，可以是一串字符，至少没那么好猜，如:"),s("code",[a._v("nimda")])])]),a._v(" "),s("li",[s("p",[a._v("将容器内"),s("code",[a._v("/www")]),a._v("目录的admin目录重命名为新名称 如："),s("code",[a._v("nimda")])])]),a._v(" "),s("li",[s("p",[a._v("修改容器内"),s("code",[a._v("/www")]),a._v("目录config.inc.php 文件修改配置。")])]),a._v(" "),s("li",[s("p",[a._v("将以下行中的admin修改成对应名称"),s("code",[a._v("nimda")]),a._v("即可")]),a._v(" "),s("p",[s("code",[a._v("define('__TYPECHO_ADMIN_DIR__', '/admin/');")]),a._v("=> "),s("code",[a._v("define('__TYPECHO_ADMIN_DIR__', '/nimda/');")])])])]),a._v(" "),s("ul",[s("li",[a._v("typecho隐藏登陆入口，这样在首页就看不到登陆入口。")])]),a._v(" "),s("ol",[s("li",[a._v("登陆管理后台，左上角"),s("code",[a._v("控制台")]),a._v("找到"),s("code",[a._v("设置外观")]),a._v(",点进去")]),a._v(" "),s("li",[a._v("取消"),s("code",[a._v("设置外观")]),a._v("下"),s("code",[a._v("显示其它杂项")]),a._v("的勾勾，然后保存设置。")])]),a._v(" "),s("ul",[s("li",[a._v("Typecho修改gravatar头像源为国内服务器源")])]),a._v(" "),s("blockquote",[s("p",[a._v("typecho代码目录下 config.inc.php 文件添加以下配置")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("   /*gravatal源*/\n define('__TYPECHO_GRAVATAR_PREFIX__', 'https://cdn.v2ex.com/gravatar/');```\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);